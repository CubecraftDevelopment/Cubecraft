import java.nio.charset.StandardCharsets

plugins {
    id 'java'
}

[compileJava, compileTestJava, javadoc]*.options*.encoding = 'UTF-8'

group 'ink.flybird'
version '1.0.0'
apply from: 'E:/Java/GlobalResources/GradleScripts/github_package_repo.gradle'

repositories {
    mavenCentral()
}

test {
    useJUnitPlatform()
}

dependencies {
    implementation project(":cubecraft-core")
    implementation project(":cubecraft-server")
    implementation project(":Quantum3D")
    implementation project(":JRakNet")

    implementation 'ink.flybird:fcommon-main:1.0.3-2'
    implementation 'org.joml:joml:1.10.5'
    implementation 'com.google.code.gson:gson:2.10.1'
    implementation 'org.iq80.leveldb:leveldb:0.12'
    implementation 'io.netty:netty-all:4.1.90.Final'

    implementation 'org.jetbrains:annotations:24.0.1'

    implementation "org.lwjgl:lwjgl:3.3.1"
    implementation "org.lwjgl:lwjgl-glfw:3.3.1"
    implementation "org.lwjgl:lwjgl-openal:3.3.1"
    implementation "org.lwjgl:lwjgl-opengl:3.3.1"

    implementation "ink.flybird:quantum3d-std:0.0.2-beta"
    implementation "ink.flybird:quantum3d-lwjgl:0.0.2-b3"
}

test {
    useJUnitPlatform()
}

jar {
    duplicatesStrategy = 'warn'
    archivesBaseName = 'Cubecraft-client'
    archiveVersion = '0.3.2' //版本
    destinationDir(file("../run"))
    manifest { //配置jar文件的manifest
        attributes(
                "Manifest-Version": 1.0,
                'Main-Class': 'ink.flybird.cubecraft.client.ClientMain' //指定main方法所在的文件
        )
    }
    //打包依赖包
    from {
        (configurations.runtimeClasspath).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

tasks.register('syncGitIgnore') {
    FileInputStream stream = new FileInputStream("../.gitignore")
    String s = new String(stream.readAllBytes(), StandardCharsets.UTF_8)
    stream.close()
    for (String s2 : s.split("\n")) {
        if (s2.length() <= 1) {
            continue
        }
        Runtime.getRuntime().exec("git", null, new File("E:/Java/Projects/Cubecraft/"))
        println "git rm -r --cached "+s2.replaceFirst("/","")
    }
}